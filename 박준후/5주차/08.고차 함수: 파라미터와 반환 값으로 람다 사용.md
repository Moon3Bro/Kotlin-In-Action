# 08.κ³ μ°¨ ν•¨μ: νλΌλ―Έν„°μ™€ λ°ν™ κ°’μΌλ΅ λλ‹¤ μ‚¬μ©

## π“Β κ³ μ°¨ ν•¨μ μ •μ

- λ‹¤λ¥Έ ν•¨μλ¥Ό μΈμλ΅ λ°›κ±°λ‚ ν•¨μλ¥Ό λ°ν™ν•λ” ν•¨μμ΄λ‹¤.

### ν•¨μ νƒ€μ…

```kotlin
val sum = { x: Int, y: Int -> x + y }
val sum = { x, y -> x + y }
```

- ν•¨μ νƒ€μ…μ„ μ •μν•κΈ°
    - ν•¨μ νλΌλ―Έν„°μ νƒ€μ…μ„ κ΄„νΈ μ•μ— λ„£κ³ , κ·Έ λ’¤μ— ν™”μ‚΄ν‘(β†’)λ¥Ό μ¶”κ°€ ν• λ‹¤μ, ν•¨μμ λ°ν™ νƒ€μ…μ„ μ§€μ •ν•λ©΄ λλ‹¤.

### μΈμλ΅ λ°›μ€ ν•¨μ νΈμ¶

- filter ν•¨μλ” μ μ–΄λ¥Ό νλΌλ―Έν„°λ΅ λ°›λ”λ‹¤. preficate νλΌλ―Έν„°λ” λ¬Έμλ¥Ό νλΌλ―Έν„°λ΅ λ°›κ³  λ¶λ¦¬μ–Έ κ²°κ³Όλ¥Ό λ°ν™ν•λ‹¤.

```kotlin
fun String.filter(predicate: (Char) -> Boolean): String {
    val sb = StringBuilder()
    for (index in indices) {
        val element = get(index)
        if (predicate(element)) sb.append(element)
    }
    return sb.toString()
}

println("ab1c".filter { it in 'a'..'z' })
>>> abc
```

### μλ°”μ—μ„ μ½”ν‹€λ¦° ν•¨μ νƒ€μ… μ‚¬μ©

- μ»΄νμΌλ μ½”λ“ μ•μ—μ„ ν•¨μ νƒ€μ…μ€ μΌλ° μΈν„°νμ΄μ¤λ΅ λ°”λ€λ‹¤. μ¦‰ ν•¨μ νƒ€μ…μ λ³€μλ” FunctionN μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•λ” κ°μ²΄λ¥Ό μ €μ¥ν•λ‹¤.
- μ½”ν‹€λ¦° ν‘μ¤€ λΌμ΄λΈλ¬λ¦¬λ” ν•¨μ μΈμμ κ°μμ— λ”°λΌ Function0<R>(μΈμκ°€ μ—†λ” ν•¨μ), Function1<P1, R>(μΈμκ°€ ν•λ‚μΈ ν•¨μ) λ“±μ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ‹¤.
- κ° μΈν„°νμ΄μ¤μ—λ” `invoke` λ©”μ†λ“ μ •μκ°€ ν•λ‚ λ“¤μ–΄μμ–΄ ν•¨μλ¥Ό μ‹¤ν–‰ν•  μ μλ‹¤.

```kotlin
fun processTheAnswer(f: (Int) -> Int) {
	println(f(42)
}

// μλ°” 8μ΄ν›„
processTheAnswer(number -> number + 1);
// μλ°” 8μ΄μ „ -> λ¬΄λ… ν΄λμ¤λ¥Ό λ„κΈ°λ©΄ λλ‹¤.
AsdKt.processTheAnswer(
    new Function1<Integer, Integer>() {
        @Override
        public Integer invoke(Integer number) {
            System.out.println(number);
            return number + 1;
        }
    }
);
```

### λ””ν΄νΈ κ°’μ„ μ§€μ •ν• ν•¨μ νƒ€μ… νλΌλ―Έν„°λ‚ λ„μ΄ λ  μ μλ” ν•¨μ νƒ€μ… νλΌλ―Έν„°

```kotlin
fun <T> Collection<T>.joinToString(
    separator: String = ", ",
    prefix: String = "",
    postfix: String = "",
    transform: (T) -> String = { it.toString() }
): String {
    val result = StringBuilder(prefix)

    for ((index, element) in this.withIndex()) {
        if (index > 0) result.append(separator)
        result.append(transform(element))
    }

    result.append(postfix)
    return result.toString()
}

val letters = listOf("Alpha", "Beta")
println(letters.joinToString())
println(letters.joinToString { it.toLowerCase() })
println(letters.joinToString(separator = "! ", postfix = "! ",
    transform = { it.toUpperCase() }))

>>> Alpha, Beta
>>> alpha, beta
>>> ALPHA! BETA! 
```

- nullμ΄ λ  μ μλ” νƒ€μ…μΌλ΅ μ„¤μ •

```kotlin
fun <T> Collection<T>.joinToString(
    separator: String = ", ",
    prefix: String = "",
    postfix: String = "",
    transform: ((T) -> String)? = null
): String {
    val result = StringBuilder(prefix)

    for ((index, element) in this.withIndex()) {
        if (index > 0) result.append(separator)
        val str = transform?.invoke(element)
            ?: element.toString()
        result.append(str)
    }

    result.append(postfix)
    return result.toString()
}
```

### ν•¨μλ¥Ό ν•¨μμ—μ„ λ°ν™

- μ‚¬μ©μ μ„ νƒν• λ°°μ†΅ μλ‹¨μ— λ”°λΌ λ°°μ†΅λΉ„λ¥Ό κ³„μ‚°ν•λ” λ°©λ²•μ— λ€ν• μμ‹

```kotlin
// ν•¨μλ¥Ό λ°ν™ν•λ” ν•¨μ
enum class Delivery { STANDARD, EXPEDITED }

class Order(val itemCount: Int)

fun getShippingCostCalculator(
    delivery: Delivery
): (Order) -> Double {
    if (delivery == Delivery.EXPEDITED) {
        return { order -> 6 + 2.1 * order.itemCount }
    }

    return { order -> 1.2 * order.itemCount }
}

val calculator = getShippingCostCalculator(Delivery.EXPEDITED)
println("Shipping costs ${calculator(Order(3))}")

>>> Shipping costs 12.3
```

### λλ‹¤λ¥Ό ν™μ©ν• μ¤‘λ³µ μ κ±°

- μ½”λ“μ μ¤‘λ³µλ„ λλ‹¤λ¥Ό ν™μ©ν•λ©΄ κ°„κ²°ν•κ³  μ‰½κ² μ κ±°κ°€ κ°€λ¥ν•λ‹¤.
    - μλ„μ° μ‚¬μ©μμ ν‰κ·  λ°©λ¬Έ μ‹κ°„ μ¶λ ¥ν•κΈ°

```kotlin
enum class OS { WINDOWS, LINUX, MAC, IOS, ANDROID }

data class SiteVisit(
    val path: String,
    val duration: Double,
    val os: OS
)

val log = listOf(
    SiteVisit("/", 34.0, OS.WINDOWS),
    SiteVisit("/", 22.0, OS.MAC),
    SiteVisit("/login", 12.0, OS.WINDOWS),
    SiteVisit("/signup", 8.0, OS.IOS),
    SiteVisit("/", 16.3, OS.ANDROID)
)

val averageWindowsDuration = log
    .filter { it.os == OS.WINDOWS }
    .map(SiteVisit::duration)
    .average()
```

- κ³ μ°¨ ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ μ¤‘λ³µ μ κ±°
    - /signup νμ΄μ§€ ν‰κ·  λ°©λ¬Έ μ‹κ°„ κµ¬ν•κΈ°

```kotlin
fun List<SiteVisit>.averageDurationFor(predicate: (SiteVisit) -> Boolean) =
    filter(predicate).map(SiteVisit::duration).average()

println(log.averageDurationFor {
    it.os in setOf(OS.ANDROID, OS.IOS) })
println(log.averageDurationFor {
    it.os == OS.IOS && it.path == "/signup" })
```

## π“Β μΈλΌμΈ ν•¨μ: λλ‹¤μ λ¶€κ°€ λΉ„μ© μ—†μ• κΈ°

<aside>
π’΅ κ³ μ°¨ ν•¨μλ¥Ό μ—¬κΈ°μ €κΈ° ν™μ©ν•λ©΄ μ „ν†µμ μΈ λ£¨ν”„μ™€ μ΅°κ±΄λ¬Έμ„ μ‚¬μ©ν•  λ•λ³΄λ‹¤ λ” λλ ¤μ§€μ§€ μ•μ„κΉ? λΌλ” μƒκ°μ΄ λ“¤ μ μλ‹¤.

</aside>

- μ½”ν‹€λ¦°μ΄ λ³΄ν†µ λλ‹¤λ¥Ό λ¬΄λ… ν΄λμ¤λ΅ μ»΄νμΌν•μ§€λ§ κ·Έλ ‡λ‹¤κ³  λλ‹¤ μ‹μ„ μ‚¬μ©ν•  λ•λ§λ‹¤ μƒλ΅μ΄ ν΄λμ¤κ°€ λ§λ“¤μ–΄μ§€μ§€λ” μ•λ”λ‹¤λ” κ²ƒμ„ μ•κ³  μλ‹¤(5μ¥)
- λλ‹¤κ°€ λ³€μλ¥Ό ν¬νν•λ©΄ λλ‹¤κ°€ μƒμ„±λλ” μ‹μ λ§λ‹¤ μƒλ΅μ΄ λ¬΄λ… ν΄λμ¤ κ°μ²΄κ°€ μƒκΈ΄λ‹¤.
    - μ΄λ° κ²½μ° μ‹¤ν–‰ μ‹μ μ— λ¬΄λ… ν΄λμ¤ μƒμ„±μ— λ”°λ¥Έ λ¶€κ°€ λΉ„μ©μ΄ λ“ λ‹¤ β†’ λ ν¨μ¨μ μ΄λ‹¤.
- `inline` λ³€κ²½μλ¥Ό μ–΄λ–¤ ν•¨μμ— λ¶™μ΄λ©΄ μ»΄νμΌλ¬λ” κ·Έ ν•¨μλ¥Ό νΈμ¶ν•λ” λ¨λ“  λ¬Έμ¥μ„ ν•¨μ λ³Έλ¬Έμ— ν•΄λ‹Ήν•λ” λ°”μ΄νΈμ½”λ“λ΅ λ°”κΏ”μΉκΈ° ν•΄μ¤€λ‹¤.

### μΈλΌμ΄λ‹μ΄ μ‘λ™ν•λ” λ°©μ‹

- μ–΄λ–¤ ν•¨μλ¥Ό `inline` μΌλ΅ μ„ μ–Έν•λ©΄ κ·Έ ν•¨μμ λ³Έλ¬Έμ΄ μΈλΌμΈλλ‹¤.
    - ν•¨μλ¥Ό νΈμ¶ν•λ” μ½”λ“λ¥Ό ν•¨μλ¥Ό νΈμ¶ν•λ” λ°”μ΄νΈμ½”λ“ λ€μ‹ μ— ν•¨μ λ³Έλ¬Έμ„ λ²μ—­ν• λ°”μ΄νΈ μ½”λ“λ΅ μ»΄νμΌν•λ‹¤.

```kotlin
inline fun <T> synchronized(lock: Lock, action: () -> T): T {
    lock.lock()
    try {
        return action()
    }
    finally {
        lock.unlock()
    }
}

fun foo(l: Lock) {
    println("Before sync")
    synchronized(l) {
        println("Action")
    }
    println("After sync")
}

// μΈλΌμ΄λ‹ λμ—μ„λ• ν•¨μ -> ν•¨μλ¥Ό νΈμ¶ν• κ³³μ— μΈλΌμ΄λ‹λλ‹¤.
fun __foo__(l: Lock) {
	println("Before sync")
  l.lock()
  try {
      println("Action"
  }
  finally {
      l.unlock()
  }
	println("After sync")
}
```

### μΈλΌμΈ ν•¨μμ ν•κ³„

- μΈλΌμ΄λ‹μ„ ν•λ” λ°©μ‹μΌλ΅ μΈν•΄ λλ‹¤λ¥Ό μ‚¬μ©ν•λ” λ¨λ“  ν•¨μλ¥Ό μΈλΌμ΄λ‹ν•  μλ” μ—†λ‹¤.
- ν•¨μ λ³Έλ¬Έμ—μ„ νλΌλ―Έν„°λ΅ λ°›μ€ λλ‹¤λ¥Ό νΈμ¶ν•λ‹¤λ©΄ κ·Έ νΈμ¶μ„ μ‰½κ² λλ‹¤ λ³Έλ¬ΈμΌλ΅ λ°”κΏ€μ μλ‹¤. ν•μ§€λ§ νλΌλ―Έν„°λ΅ λ°›μ€ λλ‹¤λ¥Ό λ‹¤λ¥Έ λ³€μμ— μ €μ¥ν•κ³  λ‚μ¤‘μ— κ·Έ λ³€μλ¥Ό μ‚¬μ©ν•λ‹¤λ©΄ λλ‹¤λ¥Ό ν‘ν„ν•λ” κ°μ²΄κ°€ μ–΄λ”κ°€λ” μ΅΄μ¬ν•΄μ•Ό ν•κΈ° λ•λ¬Έμ— λλ‹¤λ¥Ό μΈλΌμ΄λ‹ν•  μ μ—†λ‹¤.
- μΈλΌμ΄λ‹ν•λ©΄ μ• λλ” λλ‹¤λ¥Ό νλΌλ―Έν„°λ΅ λ°›λ”λ‹¤λ©΄ `noinline` λ³€κ²½μλ¥Ό νλΌλ―Έν„° μ΄λ¦„ μ•μ— λ¶™μ—¬μ„ μΈλΌμ΄λ‹μ„ κΈμ§€ν•  μ μλ‹¤.

```kotlin
inline fun foo(inline: () -> Unit, noinline notInlined: () -> Unit) {}
```

## π“Β κ³ μ°¨ ν•¨μ μ•μ—μ„ νλ¦„ μ μ–΄

### λλ‹¤ μ•μ returnλ¬Έ: λλ‹¤λ¥Ό λ‘λ¬μ‹Ό ν•¨μλ΅λ¶€ν„° λ°ν™

```kotlin
data class Person(val name: String, val age: Int)

val people = listOf(Person("Alice", 29), Person("Bob", 31))

fun lookForAlice(people: List<Person>) {
    people.forEach {
        if (it.name == "Alice") {
            println("Found!")
            return
        }
    }
    println("Alice is not found")
}

lookForAlice(people)
>>> Found!
```

- λλ‹¤ μ•μ—μ„ returnμ„ μ‚¬μ©ν•λ©΄ λλ‹¤λ΅λ¶€ν„°λ§ λ°ν™λλ” κ² μ•„λ‹λΌ **κ·Έ λλ‹¤λ¥Ό νΈμ¶ν•λ” ν•¨μ** κ°€ μ‹¤ν–‰μ„ λλ‚΄κ³  λ°ν™λλ‹¤.
- μμ‹ μ„ λ‘λ¬μ‹Έκ³  μλ” λΈ”λ΅λ³΄λ‹¤ λ” λ°”κΉ¥μ— μλ” λ‹¤λ¥Έ λΈ”λ΅μ„ λ°ν™ν•κ² λ§λ“λ” returnλ¬Έμ„ `λ„λ΅μ»¬` returnμ΄λΌ λ¶€λ¥Έλ‹¤.

<aside>
π’΅ returnμ΄ λ°”κΉ¥μ½ ν•¨μλ¥Ό λ°ν™μ‹ν‚¬ μ μλ” λ•λ” λλ‹¤λ¥Ό μΈμλ΅ λ°›λ” ν•¨μκ°€ μΈλΌμΈ ν•¨μμΈ κ²½μ°λΏμ΄λ‹¤.

</aside>

- μ„μ μμ‹μ—μ„λ” `forEach` λ” μΈλΌμΈ ν•¨μμ΄λ―€λ΅ λλ‹¤ λ³Έλ¬Έκ³Ό ν•¨κ» μΈλΌμ΄λ‹ λμ–΄ return μ‹μ΄ λ°”κΉ¥μ½ν•¨μ (lookForAlice)λ¥Ό λ°ν™μ‹ν‚¤λ„λ΅ μ‰½κ² μ»΄νμΌν•  μ μλ‹¤.

### λλ‹¤λ΅λ¶€ν„° λ°ν™: λ μ΄λΈ”μ„ μ‚¬μ©ν• return

- λλ‹¤ μ‹μ—μ„λ„ λ΅μ»¬ returnμ„ ν•  μ μλ‹¤.
    - for λ£¨ν”„μ breakκ³Ό λΉ„μ·ν• μ—­ν• μ„ ν•λ‹¤.
- λ΅μ»¬ return, λ„λ΅μ»¬ returnμ„ κµ¬λ¶„ν•κΈ°μ„ν•΄ `label(λ μ΄λΈ”)` μ„ μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.

```kotlin
fun lookForAlice(people: List<Person>) {
    people.forEach label@{
        if (it.name == "Alice") return@label
    }
    println("Alice might be somewhere")
}

lookForAlice(people)
>>> Alice might be somewhere
```

### λ¬΄λ… ν•¨μ: κΈ°λ³Έμ μΌλ΅ λ΅μ»¬ return

- λ¬΄λ… ν•¨μ μ•μ—μ„ λ μ΄λΈ”μ΄ λ¶™μ§€ μ•μ€ return μ‹μ€ λ¬΄λ… ν•¨μ μμ²΄λ¥Ό λ°ν™μ‹ν‚¬ λΏ λ¬΄λ… ν•¨μλ¥Ό λ‘λ¬μ‹Ό λ‹¤λ¥Έ ν•¨μλ¥Ό λ°ν™μ‹ν‚¤μ§€ μ•λ”λ‹¤.

```kotlin
fun lookForAlice(people: List<Person>) {
    people.forEach(fun (person) {
        if (person.name == "Alice") return
        println("${person.name} is not Alice")
    })
}

// Decompile
public static final void lookForAlice(@NotNull List people) {
  Intrinsics.checkNotNullParameter(people, "people");
  Iterable $this$forEach$iv = (Iterable)people;
  int $i$f$forEach = false;
  Iterator var3 = $this$forEach$iv.iterator();

  while(var3.hasNext()) {
     Object element$iv = var3.next();
     Person person = (Person)element$iv;
     int var6 = false;
     if (!Intrinsics.areEqual(person.getName(), "Alice")) {
        String var7 = person.getName() + " is not Alice";
        System.out.println(var7);
     }
  }
}

 =========================================

lookForAlice(people)
>>> Bob is not Alice

fun lookForAlice(people: List<Person>) {
    people.forEach {
        if (it.name == "Alice") return
        println("${it.name} is not Alice")
    }
}

// Decompile
public static final void lookForAlice(@NotNull List people) {
  Intrinsics.checkNotNullParameter(people, "people");
  Iterable $this$forEach$iv = (Iterable)people;
  int $i$f$forEach = false;
  Iterator var3 = $this$forEach$iv.iterator();

  while(var3.hasNext()) {
     Object element$iv = var3.next();
     Person it = (Person)element$iv;
     int var6 = false;
     if (Intrinsics.areEqual(it.getName(), "Alice")) {
        return;
     }

     String var7 = it.getName() + " is not Alice";
     System.out.println(var7);
  }
}

lookForAlice(people)
>>>

```

- returnλ¬Έμ€ fun ν‚¤μ›λ“λ¥Ό μ‚¬μ©ν•΄ μ •μλ κ°€μ¥ μ•μ½μ ν•¨μλ¥Ό λ°ν™ν•λ‹¤.

<img src="https://github.com/Moon3Bro/Kotlin-In-Action/assets/63226023/9dc1437e-aec8-4776-8657-4dce983881c0">